name: Reset bridge service

on:
  workflow_dispatch:

jobs:
  reset-bridge-service:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up kubectl
      uses: azure/setup-kubectl@v1
      with:
        version: 'v1.29.0'

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y jq

    - name: Configure Kubernetes Context
      run: |
        sudo mkdir ~/.kube
        sudo echo "${{ secrets.KUBECONFIG }}" | sudo base64 -d > ~/.kube/config
        export KUBECONFIG=./kubeconfig

    - name: Reset
      id: reset
      run: |
        bash .github/scripts/reset-internal-heimdall-bridge-service.sh
      env:
        GITHUB_TOKEN: ${{ secrets.P_GITHUB_TOKEN }}
