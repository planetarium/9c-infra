name: Reset bridge service

on:
  workflow_dispatch:

jobs:
  reset-bridge-service:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Set up kubectl
      uses: azure/setup-kubectl@v1
      with:
        version: 'v1.20.0' # 필요한 kubectl 버전을 명시하세요.

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y jq

    - name: Configure Kubernetes Context
      run: |
        aws eks update-kubeconfig --name 9c-internal-v2 --region us-east-2 --role-arn arn:aws:iam::319679068466:role/EKS
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.BRIDGE_RESET_AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.BRIDGE_RESET_AWS_SECRET_ACCESS_KEY }}

    - name: Reset
      id: reset
      run: |
        bash .github/scripts/reset-internal-heimdall-bridge-service.sh
      env:
        GITHUB_TOKEN: ${{ secrets.P_GITHUB_TOKEN }}
        AWS_ACCESS_KEY_ID: ${{ secrets.BRIDGE_RESET_AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.BRIDGE_RESET_AWS_SECRET_ACCESS_KEY }}
