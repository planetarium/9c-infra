{{- if $.Values.serviceAccount.create }}
apiVersion: v1
kind: ServiceAccount
metadata:
  annotations:
    eks.amazonaws.com/role-arn: {{ $.Values.serviceAccount.iamRole }}
  labels:
    app.kubernetes.io/instance: {{ $.Chart.Name }}
  name: {{ $.Values.serviceAccount.iamRole }}
  namespace: {{ $.Values.namespace }}
{{- end }}

---

apiVersion: apps/v1
kind: StatefulSet
metadata:
  labels:
    app: world-boss-service
    app.kubernetes.io/instance: {{ $.Chart.Name }}
  name: world-boss-service
  namespace: {{ $.Values.namespace }}
spec:
  podManagementPolicy: OrderedReady
  replicas: 1
  selector:
    matchLabels:
      app: season-pass
  serviceName: season-pass
  template:
    metadata:
      labels:
        app: season-pass
    spec:
      containers:
        env:
          - name: STAGE
            valueFrom:
              secretKeyRef:
                key: stage
                name: season-pass-env
          - name: REGION_NAME
            valueFrom:
              secretKeyRef:
                key: region_name
                name: season-pass-env
          - name: SQS_URL
            valueFrom:
              secretKeyRef:
                key: sqs_url
                name: season-pass-env
        image: {{ $.Values.image.repository }}:{{ $.Values.image.tag }}
        name: season-pass
      nodeSelector:
        node.kubernetes.io/instance-type: m5.large
      restartPolicy: Always
      serviceAccount: {{ $.Chart.Name }}-onboarding-iam-role
      serviceAccountName: {{ $.Chart.Name }}-onboarding-iam-role
  updateStrategy:
    type: RollingUpdate
