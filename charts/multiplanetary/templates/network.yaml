{{ range $.Values.multiplanetary }}
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: {{ .name }}
  namespace: argocd
spec:
  {{ if .autosync }}
  syncPolicy:
    automated: {}
  {{ end }}
  project: default
  source:
    repoURL: https://github.com/planetarium/9c-infra.git
    targetRevision: main
    path: charts/all-in-one
    helm:
      values: |-
        clusterName: {{ $.Values.clusterName }}
        logLevel: {{ $.Values.logLevel }}

        global:
          image:
            {{- toYaml (default $.Values.global.image .image) | nindent 12 }}
          appProtocolVersion: {{ default $.Values.global.appProtocolVersion .appProtocolVersion }}
          genesisBlockPath: {{ default $.Values.global.genesisBlockPath .genesisBlockPath }}
          trustedAppProtocolVersionSigner: {{ default $.Values.global.trustedAppProtocolVersionSigner .trustedAppProtocolVersionSigner }}
          peerStrings:
            {{- toYaml (default $.Values.global.peerStrings .peerStrings) | nindent 12 }}
          iceServers:
            {{- toYaml (default $.Values.global.iceServers .iceServers) | nindent 12 }}
          networkType: {{ default $.Values.global.networkType .networkType }}
          consensusType: {{ default $.Values.global.consensusType .consensusType }}
          resetSnapshot: {{ default $.Values.global.resetSnapshot .resetSnapshot }}
          rollbackSnapshot: {{ default $.Values.global.rollbackSnapshot .rollbackSnapshot }}
          slackToken: {{ default $.Values.global.slackToken .slackToken }}
          slackWebHookUrl: {{ default $.Values.global.slackWebHookUrl .slackWebHookUrl }}

        externalSecret:
          enabled: {{ default $.Values.externalSecret.enabled .externalSecret.enabled }}
          prefix: {{ default $.Values.clusterName .externalSecret.prefix }}

        snapshot:
          downloadSnapshot: {{ default $.Values.snapshot.downloadSnapshot .snapshot.downloadSnapshot }}
          fullSnapshot:
            {{- toYaml (default $.Values.snapshot.fullSnapshot .snapshot.fullSnapshot) | nindent 12 }}
          partitionReset:
            {{- toYaml (default $.Values.snapshot.partitionReset .snapshot.partitionReset) | nindent 12 }}
          partition:
            {{- toYaml (default $.Values.snapshot.partition .snapshot.partition) | nindent 12 }}
          slackChannel: {{ default $.Values.snapshot.slackChannel .snapshot.slackChannel }}
          image:
            {{- toYaml (default $.Values.snapshot.image .snapshot.image) | nindent 12 }}
          cfDistributionId: "{{ default $.Values.snapshot.cfDistributionId .snapshot.cfDistributionId }}"
          aws_access_key_id: "{{ default $.Values.snapshot.aws_access_key_id .snapshot.aws_access_key_id }}"
          aws_secret_access_key: "{{ default $.Values.snapshot.aws_secret_access_key .snapshot.aws_secret_access_key }}"
          path: "{{ default $.Values.snapshot.path .snapshot.path }}"

          resources:
            {{- toYaml (default $.Values.snapshot.resources .snapshot.resources) | nindent 12 }}

          nodeSelector:
            {{- toYaml (default $.Values.snapshot.nodeSelector .snapshot.nodeSelector) | nindent 12 }}

        volumeReclaimPolicy: {{ default $.Values.volumeReclaimPolicy .volumeReclaimPolicy }}

        seed:
          count: {{ default $.Values.seed.count .seed.count }}
          useTurnServer: {{ default $.Values.seed.useTurnServer .seed.useTurnServer }}
          image:
            {{- toYaml (default $.Values.seed.image .seed.image) | nindent 12 }}
          hosts:
            {{- toYaml (default $.Values.seed.hosts .seed.hosts) | nindent 12 }}
          ports:
            {{- toYaml (default $.Values.seed.ports .seed.ports) | nindent 12 }}
          workerCount: {{ default $.Values.seed.workerCount .seed.workerCount }}
          extraArgs:
            {{- toYaml (default $.Values.seed.extraArgs .seed.extraArgs) | nindent 12 }}
          privateKeys: 
            {{- toYaml (default $.Values.seed.privateKeys .seed.privateKeys) | nindent 12 }}
          env:
            {{- toYaml (default $.Values.seed.env .seed.env) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.seed.resources .seed.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.seed.nodeSelector .seed.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.seed.tolerations .seed.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default $.Values.seed.affinity .seed.affinity) | nindent 12 }}

        validator:
          count: {{ default $.Values.validator.count .validator.count }}
          image:
            {{- toYaml (default $.Values.validator.image .validator.image) | nindent 12 }}
          consensusSeedStrings:
            {{- toYaml (default $.Values.validator.consensusSeedStrings .validator.consensusSeedStrings) | nindent 12 }}
          hosts:
            {{- toYaml (default $.Values.validator.hosts .validator.hosts) | nindent 12 }}
          ports:
            {{- toYaml (default $.Values.validator.ports .validator.ports) | nindent 12 }}
          extraArgs:
            {{- toYaml (default $.Values.validator.extraArgs .validator.extraArgs) | nindent 12 }}
          privateKeys:
            {{- toYaml (default $.Values.validator.privateKeys .validator.privateKeys) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.validator.storage .validator.storage) | nindent 12 }}
          env:
            {{- toYaml (default $.Values.validator.env .validator.env) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.validator.resources .validator.resources) | nindent 12 }}
          loggingEnabled: {{ default $.Values.validator.loggingEnabled .validator.loggingEnabled }}
          nodeSelector:
            {{- toYaml (default $.Values.validator.nodeSelector .validator.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.validator.tolerations .validator.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default $.Values.validator.affinity .validator.affinity) | nindent 12 }}

        remoteHeadless:
          count: {{ default $.Values.remoteHeadless.count .remoteHeadless.count }}
          useTurnServer: {{ default $.Values.remoteHeadless.useTurnServer .remoteHeadless.useTurnServer }}
          image:
            {{- toYaml (default $.Values.remoteHeadless.image .remoteHeadless.image) | nindent 12 }}
          hosts:
            {{- toYaml (default $.Values.remoteHeadless.hosts .remoteHeadless.hosts) | nindent 12 }}
          ports:
            {{- toYaml (default $.Values.remoteHeadless.ports .remoteHeadless.ports) | nindent 12 }}
          env:
            {{- toYaml (default $.Values.remoteHeadless.env .remoteHeadless.env) | nindent 12 }}
          extraArgs:
            {{- toYaml (default $.Values.remoteHeadless.extraArgs .remoteHeadless.extraArgs) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.remoteHeadless.tolerations .remoteHeadless.tolerations) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.remoteHeadless.storage .remoteHeadless.storage) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.remoteHeadless.resources .remoteHeadless.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.remoteHeadless.nodeSelector .remoteHeadless.nodeSelector) | nindent 12 }}
          loggingEnabled: {{ default $.Values.remoteHeadless.loggingEnabled .remoteHeadless.loggingEnabled }}

        dataProvider:
          enabled: {{ default $.Values.dataProvider.enabled .dataProvider.enabled }}
          rwMode: {{ default $.Values.dataProvider.rwMode .dataProvider.rwMode }}
          render: {{ default $.Values.dataProvider.render .dataProvider.render }}
          migrateDatabase: {{ default $.Values.dataProvider.migrateDatabase .dataProvider.migrateDatabase }}
          storage:
            {{- toYaml (default $.Values.dataProvider.storage .dataProvider.storage) | nindent 12 }}
          image:
            {{- toYaml (default $.Values.dataProvider.image .dataProvider.image) | nindent 12 }}
          db:
            {{- toYaml (default $.Values.dataProvider.db .dataProvider.db) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.dataProvider.resources .dataProvider.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.dataProvider.nodeSelector .dataProvider.nodeSelector) | nindent 12 }}

        worldBoss:
          enabled: {{ default $.Values.worldBoss.enabled .worldBoss.enabled }}
          ports:
            {{- toYaml (default $.Values.worldBoss.ports .worldBoss.ports) | nindent 12 }}
          image:
            {{- toYaml (default $.Values.worldBoss.image .worldBoss.image) | nindent 12 }}
          db:
            {{- toYaml (default $.Values.worldBoss.db .worldBoss.db) | nindent 12 }}
          worldBossEnv:
            {{- toYaml (default $.Values.worldBoss.worldBossEnv .worldBoss.worldBossEnv) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.worldBoss.nodeSelector .worldBoss.nodeSelector) | nindent 12 }}

        marketService:
          enabled: {{ default $.Values.marketService.enabled .marketService.enabled }}
          rwMode: {{ default $.Values.marketService.rwMode .marketService.rwMode }}
          image:
            {{- toYaml (default $.Values.marketService.image .marketService.image) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.marketService.nodeSelector .marketService.nodeSelector) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.marketService.resources .marketService.resources) | nindent 12 }}
          env:
            {{- toYaml (default $.Values.marketService.env .marketService.env) | nindent 12 }}
          envForWrite:
            {{- toYaml (default $.Values.marketService.envForWrite .marketService.envForWrite) | nindent 12 }}
          db:
            {{- toYaml (default $.Values.marketService.db .marketService.db) | nindent 12 }}

        fullState:
          enabled: {{ default $.Values.fullState.enabled .fullState.enabled }}
          image:
            {{- toYaml (default $.Values.fullState.image .fullState.image) | nindent 12 }}
          extraArgs:
            {{- toYaml (default $.Values.fullState.extraArgs .fullState.extraArgs) | nindent 12 }}
          useTurnServer: {{ default $.Values.fullState.useTurnServer .fullState.useTurnServer }}
          host: 
            {{- toYaml (default $.Values.fullState.host .fullState.host) | nindent 12 }}
          ports:
            {{- toYaml (default $.Values.fullState.ports .fullState.ports) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.fullState.storage .fullState.storage) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.fullState.resources .fullState.resources) | nindent 12 }}
          env:
            {{- toYaml (default $.Values.fullState.env .fullState.env) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.fullState.nodeSelector .fullState.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.fullState.tolerations .fullState.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default $.Values.fullState.affinity .fullState.affinity) | nindent 12 }}
          loggingEnabled: {{ default $.Values.fullState.loggingEnabled .fullState.loggingEnabled }}

        patrolRewardService:
          enabled: {{ default $.Values.patrolRewardService.enabled .patrolRewardService.enabled }}
          image:
            {{- toYaml (default $.Values.patrolRewardService.image .patrolRewardService.image) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.patrolRewardService.nodeSelector .patrolRewardService.nodeSelector) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.patrolRewardService.resources .patrolRewardService.resources) | nindent 12 }}
          env:
            {{- toYaml (default $.Values.patrolRewardService.env .patrolRewardService.env) | nindent 12 }}
          db:
            {{- toYaml (default $.Values.patrolRewardService.db .patrolRewardService.db) | nindent 12 }}
  
        rudolfService:
          enabled: {{ default $.Values.rudolfService.enabled .rudolfService.enabled }}
          image:
            {{- toYaml (default $.Values.rudolfService.image .rudolfService.image) | nindent 12 }}
          config:
            {{- toYaml (default $.Values.rudolfService.config .rudolfService.config) | nindent 12 }}
          kms:
            {{- toYaml (default $.Values.rudolfService.kms .rudolfService.kms) | nindent 12 }}
          serviceAccount:
            {{- toYaml (default $.Values.rudolfService.serviceAccount .rudolfService.serviceAccount) | nindent 12 }}
          service:
            {{- toYaml (default $.Values.rudolfService.service .rudolfService.service) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.rudolfService.nodeSelector .rudolfService.nodeSelector) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.rudolfService.resources .rudolfService.resources) | nindent 12 }}
          db:
            {{- toYaml (default $.Values.rudolfService.db .rudolfService.db) | nindent 12 }}
        
        bridgeService:
          enabled: {{ default $.Values.bridgeService.enabled .bridgeService.enabled }}
          serviceAccount:
            {{- toYaml (default $.Values.bridgeService.serviceAccount .bridgeService.serviceAccount) | nindent 12 }}
          image:
            {{- toYaml (default $.Values.bridgeService.image .bridgeService.image) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.bridgeService.storage .bridgeService.storage) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.bridgeService.nodeSelector .bridgeService.nodeSelector) | nindent 12 }}
        
        bridge:
          enabled: {{ default $.Values.bridge.enabled .bridge.enabled }}
          bridgeObserverImage:
            {{- toYaml (default $.Values.bridge.bridgeObserverImage .bridge.bridgeObserverImage) | nindent 12 }}
          bridgeStatusBotImage:
            {{- toYaml (default $.Values.bridge.bridgeStatusBotImage .bridge.bridgeStatusBotImage) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.bridge.nodeSelector .bridge.nodeSelector) | nindent 12 }}

        volumeRotator:
          enabled: {{ default $.Values.volumeRotator.enabled .volumeRotator.enabled }}
          serviceAccount:
            {{- toYaml (default $.Values.volumeRotator.serviceAccount .volumeRotator.serviceAccount) | nindent 12 }}
          image:
            {{- toYaml (default $.Values.volumeRotator.image .volumeRotator.image) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.volumeRotator.nodeSelector .volumeRotator.nodeSelector) | nindent 12 }}

        acc:
          enabled: {{ default $.Values.acc.enabled .acc.enabled }}
          redis:
            port: {{ default $.Values.acc.redis.port .acc.redis.port }}
            nodeSelector:
              {{- toYaml (default $.Values.acc.redis.nodeSelector .acc.redis.nodeSelector) | nindent 14 }}
          image:
            {{- toYaml (default $.Values.acc.image .acc.image) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.acc.nodeSelector .acc.nodeSelector) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.acc.resources .acc.resources) | nindent 12 }}
          env:
            {{- toYaml (default $.Values.acc.env .acc.env) | nindent 12 }}

        emptyChronicle:
          enabled: {{ default $.Values.emptyChronicle.enabled .emptyChronicle.enabled }}
          image:
            {{- toYaml (default $.Values.emptyChronicle.image .emptyChronicle.image) | nindent 12 }}
          ports:
            {{- toYaml (default $.Values.emptyChronicle.ports .emptyChronicle.ports) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.emptyChronicle.resources .emptyChronicle.resources) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.emptyChronicle.storage .emptyChronicle.storage) | nindent 12 }}

        lib9cStateService:
          enabled: {{ default $.Values.lib9cStateService.enabled .lib9cStateService.enabled }}
          image:
            {{- toYaml (default $.Values.lib9cStateService.image .lib9cStateService.image) | nindent 12 }}
          ports:
            {{- toYaml (default $.Values.lib9cStateService.ports .lib9cStateService.ports) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.lib9cStateService.resources .lib9cStateService.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.lib9cStateService.nodeSelector .lib9cStateService.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.lib9cStateService.tolerations .lib9cStateService.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default $.Values.lib9cStateService.affinity .lib9cStateService.affinity) | nindent 12 }}

        remoteActionEvaluatorHeadless:
          enabled: {{ default $.Values.remoteActionEvaluatorHeadless.enabled .remoteActionEvaluatorHeadless.enabled }}
          image:
            {{- toYaml (default $.Values.remoteActionEvaluatorHeadless.image .remoteActionEvaluatorHeadless.image) | nindent 12 }}
          loggingEnabled: {{ default $.Values.remoteActionEvaluatorHeadless.loggingEnabled .remoteActionEvaluatorHeadless.loggingEnabled }}
          extraArgs:
            {{- toYaml (default $.Values.remoteActionEvaluatorHeadless.extraArgs .remoteActionEvaluatorHeadless.extraArgs) | nindent 12 }}
          useTurnServer: {{ default $.Values.remoteActionEvaluatorHeadless.useTurnServer .remoteActionEvaluatorHeadless.useTurnServer }}
          host: {{ default $.Values.remoteActionEvaluatorHeadless.host .remoteActionEvaluatorHeadless.host }}
          ports:
            {{- toYaml (default $.Values.remoteActionEvaluatorHeadless.ports .remoteActionEvaluatorHeadless.ports) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.remoteActionEvaluatorHeadless.storage .remoteActionEvaluatorHeadless.storage) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.remoteActionEvaluatorHeadless.resources .remoteActionEvaluatorHeadless.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.remoteActionEvaluatorHeadless.nodeSelector .remoteActionEvaluatorHeadless.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.remoteActionEvaluatorHeadless.tolerations .remoteActionEvaluatorHeadless.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default $.Values.remoteActionEvaluatorHeadless.affinity .remoteActionEvaluatorHeadless.affinity) | nindent 12 }}
        
        testHeadless2:
          enabled: {{ default $.Values.testHeadless2.enabled .testHeadless2.enabled }}
          image:
            {{- toYaml (default $.Values.testHeadless2.image .testHeadless2.image) | nindent 12 }}
          loggingEnabled: {{ default $.Values.testHeadless2.loggingEnabled .testHeadless2.loggingEnabled }}
          extraArgs:
            {{- toYaml (default $.Values.testHeadless2.extraArgs .testHeadless2.extraArgs) | nindent 12 }}
          useTurnServer: {{ default $.Values.testHeadless2.useTurnServer .testHeadless2.useTurnServer }}
          env:
            {{- toYaml (default $.Values.testHeadless2.env .testHeadless2.env) | nindent 12 }}
          host: {{ default $.Values.testHeadless2.host .testHeadless2.host }}
          ports:
            {{- toYaml (default $.Values.testHeadless2.ports .testHeadless2.ports) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.testHeadless2.storage .testHeadless2.storage) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.testHeadless2.resources .testHeadless2.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.testHeadless2.nodeSelector .testHeadless2.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.testHeadless2.tolerations .testHeadless2.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default $.Values.testHeadless2.affinity .testHeadless2.affinity) | nindent 12 }}

        testHeadless1:
          enabled: {{ default $.Values.testHeadless1.enabled .testHeadless1.enabled }}
          image:
            {{- toYaml (default $.Values.testHeadless1.image .testHeadless1.image) | nindent 12 }}
          loggingEnabled: {{ default $.Values.testHeadless1.loggingEnabled .testHeadless1.loggingEnabled }}
          extraArgs:
            {{- toYaml (default $.Values.testHeadless1.extraArgs .testHeadless1.extraArgs) | nindent 12 }}
          useTurnServer: {{ default $.Values.testHeadless1.useTurnServer .testHeadless1.useTurnServer }}
          env:
            {{- toYaml (default $.Values.testHeadless1.env .testHeadless1.env) | nindent 12 }}
          host: {{ default $.Values.testHeadless1.host .testHeadless1.host }}
          ports:
            {{- toYaml (default $.Values.testHeadless1.ports .testHeadless1.ports) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.testHeadless1.storage .testHeadless1.storage) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.testHeadless1.resources .testHeadless1.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.testHeadless1.nodeSelector .testHeadless1.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.testHeadless1.tolerations .testHeadless1.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default $.Values.testHeadless1.affinity .testHeadless1.affinity) | nindent 12 }}

        explorer:
          enabled: {{ default $.Values.explorer.enabled .explorer.enabled }}
          image:
            {{- toYaml (default $.Values.explorer.image .explorer.image) | nindent 12 }}
          extraArgs:
            {{- toYaml (default $.Values.explorer.extraArgs .explorer.extraArgs) | nindent 12 }}
          useTurnServer: {{ default true .explorer.useTurnServer }}
          host: {{ default "" .explorer.host }}
          ports:
            {{- toYaml (default $.Values.explorer.ports .explorer.ports) | nindent 12 }}
          storage:
            {{- toYaml (default $.Values.explorer.storage .explorer.storage) | nindent 12 }}
          resources:
            {{- toYaml (default $.Values.explorer.resources .explorer.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default $.Values.explorer.nodeSelector .explorer.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default $.Values.explorer.tolerations .explorer.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default $.Values.explorer.affinity .explorer.affinity) | nindent 12 }}

        blockIntervalNotifier:
          enabled: {{ default $.Values.blockIntervalNotifier.enabled .blockIntervalNotifier.enabled }}

  destination:
    server: https://kubernetes.default.svc
    namespace: {{ .name }}
---
{{ end }}
