{{ if .Values.alfheim.enabled }}
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: alfheim
  namespace: argocd
spec:
  project: default
  syncPolicy:
    automated: {}
  source:
    repoURL: https://github.com/planetarium/9c-infra.git
    targetRevision: main
    path: charts/all-in-one
    helm:
      values: |-
        clusterName: {{ .Values.clusterName }}
        logLevel: {{ .Values.logLevel }}

        global:
          image:
            {{- toYaml (default $.Values.global.image $.Values.alfheim.image) | nindent 12 }}
          appProtocolVersion: {{ default .Values.global.appProtocolVersion .Values.alfheim.appProtocolVersion }}
          genesisBlockPath: {{ default .Values.global.genesisBlockPath .Values.alfheim.genesisBlockPath }}
          trustedAppProtocolVersionSigner: {{ default .Values.global.trustedAppProtocolVersionSigner .Values.alfheim.trustedAppProtocolVersionSigner }}
          peerStrings:
            {{- toYaml (default $.Values.global.peerStrings $.Values.alfheim.peerStrings) | nindent 12 }}
          iceServers:
            {{- toYaml (default $.Values.global.iceServers $.Values.alfheim.iceServers) | nindent 12 }}
          networkType: {{ default .Values.global.networkType .Values.alfheim.networkType }}
          consensusType: {{ default .Values.global.consensusType .Values.alfheim.consensusType }}
          resetSnapshot: {{ default .Values.global.resetSnapshot .Values.alfheim.resetSnapshot }}
          slackToken: {{ default .Values.global.slackToken .Values.alfheim.slackToken }}
          slackWebHookUrl: {{ default .Values.global.slackWebHookUrl .Values.alfheim.slackWebHookUrl }}

        externalSecret:
          enabled: {{ default .Values.externalSecret.enabled .Values.alfheim.externalSecret.enabled }}
          prefix: "{{ .Values.clusterName }}/alfheim"

        snapshot:
          downloadSnapshot: {{ default .Values.snapshot.downloadSnapshot .Values.alfheim.snapshot.downloadSnapshot }}
          fullSnapshot:
            {{- toYaml (default $.Values.snapshot.fullSnapshot $.Values.alfheim.snapshot.fullSnapshot) | nindent 12 }}
          partitionReset:
            {{- toYaml (default $.Values.snapshot.partitionReset $.Values.alfheim.snapshot.partitionReset) | nindent 12 }}
          partition:
            {{- toYaml (default $.Values.snapshot.partition $.Values.alfheim.snapshot.partition) | nindent 12 }}
          slackChannel: {{ default .Values.snapshot.slackChannel .Values.alfheim.snapshot.slackChannel }}
          image:
            {{- toYaml (default $.Values.snapshot.image $.Values.alfheim.snapshot.image) | nindent 12 }}
          cfDistributionId: "{{ default $.Values.snapshot.cfDistributionId .Values.alfheim.snapshot.cfDistributionId }}"
          aws_access_key_id: "{{ default $.Values.snapshot.aws_access_key_id .Values.alfheim.snapshot.aws_access_key_id }}"
          aws_secret_access_key: "{{ default $.Values.snapshot.aws_secret_access_key .Values.alfheim.snapshot.aws_secret_access_key }}"
          path: "{{ .Values.clusterName }}/alfheim"

          resources:
            {{- toYaml (default $.Values.snapshot.resources $.Values.alfheim.snapshot.resources) | nindent 12 }}

          nodeSelector:
            {{- toYaml (default $.Values.snapshot.nodeSelector $.Values.alfheim.snapshot.nodeSelector) | nindent 12 }}

        volumeReclaimPolicy: {{ default .Values.volumeReclaimPolicy .Values.alfheim.volumeReclaimPolicy }}

        seed:
          count: {{ default .Values.seed.count .Values.alfheim.seed.count }}
          useTurnServer: {{ default .Values.seed.useTurnServer .Values.alfheim.seed.useTurnServer }}
          image:
            {{- toYaml (default .Values.seed.image .Values.alfheim.seed.image) | nindent 12 }}
          hosts:
            {{- toYaml (default .Values.seed.hosts .Values.alfheim.seed.hosts) | nindent 12 }}
          ports:
            {{- toYaml (default .Values.seed.ports .Values.alfheim.seed.ports) | nindent 12 }}
          workerCount: {{ default .Values.seed.workerCount .Values.alfheim.seed.workerCount }}
          extraArgs:
            {{- toYaml (default .Values.seed.extraArgs .Values.alfheim.seed.extraArgs) | nindent 12 }}
          privateKeys: 
            {{- toYaml (default .Values.seed.privateKeys .Values.alfheim.seed.privateKeys) | nindent 12 }}
          env:
            {{- toYaml (default .Values.seed.env .Values.alfheim.seed.env) | nindent 12 }}
          resources:
            {{- toYaml (default .Values.seed.resources .Values.alfheim.seed.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default .Values.seed.nodeSelector .Values.alfheim.seed.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default .Values.seed.tolerations .Values.alfheim.seed.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default .Values.seed.affinity .Values.alfheim.seed.affinity) | nindent 12 }}

        validator:
          count: {{ default .Values.validator.count .Values.alfheim.validator.count }}
          image:
            {{- toYaml (default .Values.validator.image .Values.alfheim.validator.image) | nindent 12 }}
          consensusSeedStrings:
            {{- toYaml (default .Values.validator.consensusSeedStrings .Values.alfheim.validator.consensusSeedStrings) | nindent 12 }}
          hosts:
            {{- toYaml (default .Values.validator.hosts .Values.alfheim.validator.hosts) | nindent 12 }}
          ports:
            {{- toYaml (default .Values.validator.ports .Values.alfheim.validator.ports) | nindent 12 }}
          extraArgs:
            {{- toYaml (default .Values.validator.extraArgs .Values.alfheim.validator.extraArgs) | nindent 12 }}
          privateKeys:
            {{- toYaml (default .Values.validator.privateKeys .Values.alfheim.validator.privateKeys) | nindent 12 }}
          storage:
            data: {{ default "1000Gi" .Values.alfheim.validator.storage.data }}
          env:
            {{- toYaml (default .Values.validator.env .Values.alfheim.validator.env) | nindent 12 }}
          resources:
            {{- toYaml (default .Values.validator.resources .Values.alfheim.validator.resources) | nindent 12 }}
          loggingEnabled: {{ default .Values.validator.loggingEnabled .Values.alfheim.validator.loggingEnabled }}
          nodeSelector:
            {{- toYaml (default .Values.validator.nodeSelector .Values.alfheim.validator.nodeSelector) | nindent 12 }}
          tolerations:
            {{- toYaml (default .Values.validator.tolerations .Values.alfheim.validator.tolerations) | nindent 12 }}
          affinity:
            {{- toYaml (default .Values.validator.affinity .Values.alfheim.validator.affinity) | nindent 12 }}

        remoteHeadless:
          count: {{ default .Values.remoteHeadless.count .Values.alfheim.remoteHeadless.count }}
          image:
            {{- toYaml (default .Values.remoteHeadless.image .Values.alfheim.remoteHeadless.image) | nindent 12 }}
          hosts:
            {{- toYaml (default .Values.remoteHeadless.hosts .Values.alfheim.remoteHeadless.hosts) | nindent 12 }}
          ports:
            {{- toYaml (default .Values.remoteHeadless.ports .Values.alfheim.remoteHeadless.ports) | nindent 12 }}
          storage:
            data: {{ default "500Gi" .Values.alfheim.remoteHeadless.storage.data }}
          resources:
            {{- toYaml (default .Values.remoteHeadless.resources .Values.alfheim.remoteHeadless.resources) | nindent 12 }}
          nodeSelector:
            {{- toYaml (default .Values.remoteHeadless.nodeSelector .Values.alfheim.remoteHeadless.nodeSelector) | nindent 12 }}

        dataProvider:
          {{- toYaml (default .Values.dataProvider .Values.alfheim.dataProvider) | nindent 10 }}

        worldBoss:
          {{- toYaml (default .Values.worldBoss .Values.alfheim.worldBoss) | nindent 10 }}

        marketService:
          {{- toYaml (default .Values.marketService .Values.alfheim.marketService) | nindent 10 }}

        patrolRewardService:
          {{- toYaml (default .Values.patrolRewardService .Values.alfheim.patrolRewardService) | nindent 10 }}

        rudolfService:
          {{- toYaml (default .Values.rudolfService .Values.alfheim.rudolfService) | nindent 10 }}

  destination:
    server: https://kubernetes.default.svc
    namespace: alfheim
{{ end }}
